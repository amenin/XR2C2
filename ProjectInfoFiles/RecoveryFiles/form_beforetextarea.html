<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XR2C2 Form</title>
    <!-- Link to external CSS file -->
    <link rel="stylesheet" href="Css/formStyle.css">
</head>

<body>
    <!-- Form element -->
    <form id="dynamicForm" action="http://localhost:3000/submit-form" method="POST"></form>

    <script>
        // Function to create form elements dynamically
        function createForm(json) {
            const form = document.getElementById('dynamicForm');
            const formData = {};

            // Function to extract data from list-type attributes
            function extractListData(labelId) {
                const divContainers = document.querySelectorAll(`div[data-label="${labelId}"]`);
                const listData = [];

                divContainers.forEach(container => {
                    const inputs = container.querySelectorAll('input');
                    const object = {};

                    inputs.forEach(input => {
                        object[input.getAttribute('placeholder')] = input.value.trim();
                    });

                    // Check if the object is not empty before pushing it to the listData array
                    if (Object.keys(object).length !== 0) {
                        listData.push(object);
                    }
                });

                return listData;
            }

            // Loop through each category in the JSON data
            json.forEach(category => {
                Object.entries(category).forEach(([catName, attributes]) => {
                    formData[catName] = {};
                    const fieldset = document.createElement('fieldset');
                    const legend = document.createElement('legend');
                    legend.textContent = catName;
                    fieldset.appendChild(legend);

                    // Loop through each attribute in the category
                    attributes.forEach(attr => {
                        formData[catName][attr.label] = '';
                        const label = document.createElement('label');
                        label.setAttribute('id', attr.label);
                        label.textContent = attr.label;
                        fieldset.appendChild(label);

                        // Check attribute type and create corresponding form elements
                        if (attr.type.toLowerCase() === 'list') {
                            // Add button to dynamically add list items
                            const addButton = document.createElement('button');
                            addButton.textContent = 'Add ' + attr.label;
                            addButton.type = 'button';
                            addButton.onclick = () => {
                                const listItem = document.createElement('div');
                                listItem.setAttribute('data-label', attr.label);
                                attr.children[0].forEach(child => {
                                    const childInput = document.createElement('input');
                                    childInput.setAttribute('placeholder', child.label);
                                    childInput.setAttribute('type', child.type.toLowerCase());
                                    listItem.appendChild(childInput);
                                });
                                fieldset.insertBefore(listItem, addButton);
                            };
                            fieldset.appendChild(addButton);
                        } else if (attr.type.toLowerCase() === 'boolean') {
                            // Add radio buttons for boolean type
                            const radioTrue = document.createElement('input');
                            radioTrue.setAttribute('type', 'radio');
                            radioTrue.setAttribute('name', catName + '_' + attr.label);
                            radioTrue.setAttribute('value', 'true');
                            const labelTrue = document.createElement('label');
                            labelTrue.textContent = 'True';
                            labelTrue.appendChild(radioTrue);
                            fieldset.appendChild(labelTrue);

                            const radioFalse = document.createElement('input');
                            radioFalse.setAttribute('type', 'radio');
                            radioFalse.setAttribute('name', catName + '_' + attr.label);
                            radioFalse.setAttribute('value', 'false');
                            const labelFalse = document.createElement('label');
                            labelFalse.textContent = 'False';
                            labelFalse.appendChild(radioFalse);
                            fieldset.appendChild(labelFalse);
                        } else if (attr.type.toLowerCase() === 'image' || attr.type.toLowerCase() === 'video') {
                            // Add file input for image or video type
                            const fileInput = document.createElement('input');
                            fileInput.setAttribute('type', 'file');
                            fileInput.setAttribute('multiple', 'true');
                            fileInput.setAttribute('accept', `${attr.type.toLowerCase()}/*`);
                            const folderName = attr.type.toLowerCase() === 'image' ? 'Images' : 'Videos';
                            fileInput.addEventListener('change', function () {
                                const files = Array.from(this.files);
                                formData[catName][attr.label] = files.map(file => `mediaFiles/${folderName}/${file.name}`);
                            });
                            fieldset.appendChild(fileInput);
                        } else {
                            // For other types, create regular input element
                            const input = document.createElement('input');
                            input.setAttribute('name', catName + '_' + attr.label);
                            input.setAttribute('type', attr.type.toLowerCase());
                            fieldset.appendChild(input);
                        }
                    });
                    form.appendChild(fieldset);
                });
            });

            // Add submit button to the form
            const submitButton = document.createElement('button');
            submitButton.textContent = 'Submit';
            submitButton.type = 'submit';
            form.appendChild(submitButton);

            // Attach event listener for form submission
            form.addEventListener('submit', (event) => {
                event.preventDefault();
                const formDataOutput = {};
                // Convert form data into JSON format
                Object.entries(formData).forEach(([category, attributes]) => {
                    formDataOutput[category] = {};
                    Object.entries(attributes).forEach(([label, value]) => {
                        if (Array.isArray(value)) {
                            formDataOutput[category][label] = value;
                        } else {
                            const input = document.querySelector(`input[name="${category}_${label}"]`);
                            if (input) {
                                // Convert boolean values from strings to actual boolean values
                                if (input.type === 'checkbox' || input.type === 'radio') {
                                    formDataOutput[category][label] = Boolean(input.checked);
                                } else {
                                    formDataOutput[category][label] = input.value;
                                }
                            } else {
                                const listData = extractListData(label);
                                formDataOutput[category][label] = listData;
                            }
                        }
                    });
                });
                console.log(formDataOutput);

                // Submit the form data
                fetch(form.action, {
                    method: form.method,
                    body: JSON.stringify(formDataOutput),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.text())
                    .then(data => console.log(data))
                    .catch(error => console.error('Error submitting form:', error));
            });
        }

        // Fetch JSON data from file
        fetch('Json_Structure.json')
            .then(response => response.json())
            .then(data => createForm(data))
            .catch(error => console.error('Error fetching JSON:', error));

    </script>
</body>

</html>