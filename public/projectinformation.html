<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title></title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="styles/bootstrapStyle/img/favicon.png" rel="icon">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="styles/bootstrapStyle/vendor/aos/aos.css" rel="stylesheet">
    <link href="styles/bootstrapStyle/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="styles/bootstrapStyle/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="styles/bootstrapStyle/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="styles/bootstrapStyle/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="styles/bootstrapStyle/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="styles/bootstrapStyle/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="styles/bootstrapStyle/css/style.css" rel="stylesheet">

</head>

<body>

    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top d-flex align-items-center">
        <div class="container d-flex align-items-center justify-content-between">

            <div class="logo">
                <div class="d-flex align-items-center">
                    <a href="index.html"><img src="styles/bootstrapStyle/img/apple-touch-icon.png" alt=""
                            class="img-fluid"></a>
                    <!-- <h1 style="margin-left: 10px;"><a href="index.html">XR²C²</a></h1>-->
                </div>
            </div>

            <nav id="navbar" class="navbar">
                <ul>
                    <li><a class="nav-link scrollto active" href="index.html">Home</a></li>
                    <li><a class="nav-link scrollto " href="projects.html">Projects</a></li>
                    <li><a class="nav-link scrollto" href="about.html">About</a></li>
                    <li><a class="nav-link scrollto" href="contact.html">Contact</a></li>
                    <li><a class="nav-link scrollto" href="account.html">Account</a></li>

                </ul>
                <i class="bi bi-list mobile-nav-toggle"></i>
            </nav><!-- .navbar -->

        </div>
    </header><!-- End Header -->

    <main id="main">

        <!-- ======= Breadcrumbs ======= -->
        <section id="breadcrumbs" class="breadcrumbs">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 id="projectName"></h2>
                </div>
            </div>
        </section><!-- End Breadcrumbs -->

        <!-- ======= Portfolio Details Section ======= -->
        <section id="portfolio-details" class="portfolio-details">
            <div class="container">
                <div class="row gy-4">
                    <div class="col-lg-8">
                        <!-- Portfolio images slider -->
                        <div id="carouselExampleRide" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner align-items-center" id="imageSlider">
                                <!-- Images will be dynamically added here -->
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleRide"
                                data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleRide"
                                data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <!-- Non Technical Description -->
                        <div class="portfolio-info">
                            <h3>Project Information</h3>
                            <ul>
                                <!-- Non Technical Description attributes will be dynamically added here -->
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <!-- Description -->
                        <div class="portfolio-description">
                            <h2>Description</h2>
                            <p id="projectGoal">
                                <!-- Project goal will be dynamically added here -->
                            </p>
                        </div>
                    </div>
                    <!-- Categories accordion -->
                    <div class="col-lg-12">
                        <h2 class="titlesStyle">Categories</h2>
                        <div class="accordion" id="accordionPanelsStayOpenExample">
                            <!-- Categories will be dynamically added here -->
                        </div>
                    </div>
                    <!-- Video section -->
                    <div class="col-lg-12 mt-5">
                        <h2 class="titlesStyle">Video</h2>
                        <div id="carouselExample" class="carousel slide">
                            <div class="carousel-inner">
                                <!-- Videos will be dynamically added here -->
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample"
                                data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carouselExample"
                                data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>


    </main><!-- End #main -->

    <!-- ======= Footer ======= -->
    <footer id="footer">
        <div class="container">
            <div class="row d-flex align-items-center">

                <div class="col-lg-15 mb-3">
                    <nav class="footer-links text-lg-right text-center pt-2 pt-lg-0">
                        <a href="index.html"><img src="styles/bootstrapStyle/img/apple-touch-icon.png" alt=""
                                class="footerlogo"></a>
                        <div class="social-links ">
                            <a class="scrollto" href="index.html">Home</a>
                            <a class="scrollto " href="projects.html">Projects</a>
                            <a class="scrollto" href="about.html">About</a></li>
                            <a class="scrollto" href="contact.html">Contact</a>
                            <a class="scrollto" href="account.html">Account</a>
                    </nav>
                </div>
                <div class="col-lg-15 text-lg-left text-center">
                    <div class="copyright">
                        &copy; Copyright <strong>XR²C²</strong>
                    </div>

                </div>

            </div>
        </div>
    </footer><!-- End Footer -->

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <!-- Vendor JS Files -->
    <script src="styles/bootstrapStyle/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="styles/bootstrapStyle/vendor/aos/aos.js"></script>
    <script src="styles/bootstrapStyle/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="styles/bootstrapStyle/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="styles/bootstrapStyle/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="styles/bootstrapStyle/vendor/swiper/swiper-bundle.min.js"></script>

    <!-- Template Main JS File -->
    <script src="styles/bootstrapStyle/js/main.js"></script>

    <script>

        // Function to retrieve various project data from projects.json
        function fetchProjectData(projectId) {
            return fetch('projects')
                .then(response => response.json())
                .then(data => {
                    const project = data.find(project => project.id == projectId);
                    if (project) {
                        // Call functions to update the page with project data
                        updateBreadcrumbs(project["Non Technical Description"]["NonTechnicalDescription_NameID"]);
                        updateProjectDescription(project["Non Technical Description"]["NonTechnicalDescription_GoalID"]);
                        fetchProjectImages(projectId);
                        fetchProjectVideos(projectId);

                        // Display attributes for "Non Technical Description" category
                        const nonTechDescAttributes = Object.entries(project["Non Technical Description"])
                            .map(([key, value]) => ({ key, value }));

                        const excludedAttributesNonTechDescAttributes = ['NonTechnicalDescription_ImageFilesID', 'NonTechnicalDescription_VideoFilesID', 'NonTechnicalDescription_NameID', 'NonTechnicalDescription_GoalID']; // Add attributes to exclude here

                        displayNonTechDescriptionAttributes(nonTechDescAttributes, excludedAttributesNonTechDescAttributes);


                        // Define excluded attributes for each category
                        const excludedAttributes = {
                            'id': 'all', // Exclude entire Category
                            'Non Technical Description': 'all',
                            'Project Visibility': 'all'
                            // 'Interview': ['attributes1','attributes2'] // Exclude Attribute from Category
                        };
                        displayAllCategories(projectId, excludedAttributes);


                    } else {
                        throw new Error('Project not found');
                    }
                })
                .catch(error => console.error('Error fetching project data:', error));
        }

        // Function to update the breadcrumbs section with the project name
        function updateBreadcrumbs(projectName) {
            document.getElementById('projectName').innerText = projectName;
            // Update the title of the page
            document.title = projectName;
        }

        // Function to update the project description section with the project goal
        function updateProjectDescription(projectGoal) {
            document.getElementById('projectGoal').innerText = projectGoal;
        }

        // Function to retrieve and display project images
        function fetchProjectImages(projectId) {
            return fetch('projects')
                .then(response => response.json())
                .then(data => {
                    const project = data.find(project => project.id == projectId);
                    if (!project) {
                        throw new Error('Project not found');
                    }
                    const nonTechDesc = project['Non Technical Description'];
                    if (nonTechDesc && nonTechDesc['NonTechnicalDescription_ImageFilesID']) {
                        const imageFiles = nonTechDesc['NonTechnicalDescription_ImageFilesID'];
                        const swiperWrapper = document.querySelector('.carousel-inner');
                        swiperWrapper.innerHTML = ''; // Clear existing content
                        if (imageFiles && imageFiles.length > 0 && imageFiles[0]['ImageFilesID_ImagePathID']) {
                            imageFiles[0]['ImageFilesID_ImagePathID'].forEach((imagePath, index) => {
                                const carouselItem = document.createElement('div');
                                carouselItem.classList.add('carousel-item');
                                if (index === 0) {
                                    carouselItem.classList.add('active');
                                }
                                const img = document.createElement('img');
                                img.src = imagePath || '/mediaFiles/Images/placeholder.jpg'; // Use placeholder if imagePath is not available
                                img.classList.add('d-block', 'w-100');
                                img.alt = '';
                                // Add click event listener to each image
                                img.addEventListener('click', () => displayImageModal(imagePath));
                                carouselItem.appendChild(img);
                                swiperWrapper.appendChild(carouselItem);
                            });
                        } else {
                            // If no image paths are found, display placeholder image
                            const carouselItem = document.createElement('div');
                            carouselItem.classList.add('carousel-item', 'active');
                            const img = document.createElement('img');
                            img.src = '/mediaFiles/Images/placeholder.jpg';
                            img.classList.add('d-block', 'w-100');
                            img.alt = ''; // You can set the alt text if needed
                            carouselItem.appendChild(img);
                            swiperWrapper.appendChild(carouselItem);
                        }
                    } else {
                        throw new Error('No image files found');
                    }
                })
                .catch(error => console.error('Error fetching project images:', error));
        }

        // Function to display image in a modal when clicked
        function displayImageModal(imagePath) {
            // Check if a modal is already open
            const existingModal = document.querySelector('.modal');
            if (existingModal) {
                // If a modal is already open, update its content and return
                const modalBody = existingModal.querySelector('.modal-body');
                modalBody.innerHTML = `
            <img src="${imagePath}" class="img-fluid" alt="">
            <span class="modal-arrow left">&lt;</span>
            <span class="modal-arrow right">&gt;</span>
        `;
                return;
            }

            // Create modal content
            const modalContent = `
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <img src="${imagePath}" class="img-fluid" alt="">
                    <span class="modal-arrow left">&lt;</span>
                    <span class="modal-arrow right">&gt;</span>
                </div>
            </div>
        </div>
    `;

            // Create modal element
            const modal = document.createElement('div');
            modal.classList.add('modal', 'fade');
            modal.innerHTML = modalContent;

            // Add modal to body
            document.body.appendChild(modal);

            // Initialize modal using Bootstrap's Modal component
            const modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();

            // Remove modal from DOM after it's hidden
            modal.addEventListener('hidden.bs.modal', () => {
                modal.remove();
            });
        }

        // Set up event listeners for modal navigation arrows
        document.body.addEventListener('click', event => {
            const target = event.target;
            if (target.classList.contains('modal-arrow')) {
                const direction = target.classList.contains('left') ? 'left' : 'right';
                const activeImage = document.querySelector('.modal-body img');
                const carouselItems = Array.from(document.querySelectorAll('.carousel-item'));
                const currentIndex = carouselItems.findIndex(item => item.querySelector('img').src === activeImage.src);

                let newIndex;
                if (direction === 'left') {
                    newIndex = currentIndex === 0 ? carouselItems.length - 1 : currentIndex - 1;
                } else {
                    newIndex = currentIndex === carouselItems.length - 1 ? 0 : currentIndex + 1;
                }

                const newImage = carouselItems[newIndex].querySelector('img');
                displayImageModal(newImage.src);
            }
        });

        // Function to retrieve and display project videos
        function fetchProjectVideos(projectId) {
            return fetch('projects')
                .then(response => response.json())
                .then(data => {
                    const project = data.find(project => project.id == projectId);
                    if (!project) {
                        throw new Error('Project not found');
                    }
                    const nonTechDesc = project['Non Technical Description'];
                    if (nonTechDesc && nonTechDesc['NonTechnicalDescription_VideoFilesID']) {
                        const videoFiles = nonTechDesc['NonTechnicalDescription_VideoFilesID'];
                        const videoCarousel = document.getElementById('carouselExample');
                        const carouselInner = videoCarousel.querySelector('.carousel-inner');
                        carouselInner.innerHTML = ''; // Clear existing content
                        if (videoFiles && videoFiles.length > 0 && videoFiles[0]['VideoFilesID_VideoPathID']) {
                            videoFiles[0]['VideoFilesID_VideoPathID'].forEach(videoPath => {
                                const videoItem = document.createElement('div');
                                videoItem.classList.add('carousel-item');
                                const video = document.createElement('video');
                                video.classList.add('d-block', 'w-100');
                                video.controls = true;
                                video.preload = 'auto';
                                video.loop = true;
                                video.muted = true;
                                const source = document.createElement('source');
                                source.src = videoPath;
                                video.appendChild(source);
                                videoItem.appendChild(video);
                                carouselInner.appendChild(videoItem);
                            });
                            carouselInner.firstChild.classList.add('active'); // Set the first video as active
                        } else {
                            // If no video paths are found, display placeholder video
                            const videoItem = document.createElement('div');
                            videoItem.classList.add('carousel-item', 'active');
                            const video = document.createElement('video');
                            video.classList.add('d-block', 'w-100');
                            video.controls = true;
                            video.preload = 'auto';
                            video.loop = true;
                            video.muted = true;
                            const source = document.createElement('source');
                            source.src = '/mediaFiles/Videos/placeholder.mp4'; // Placeholder video path
                            source.type = 'video/mp4';
                            video.appendChild(source);
                            videoItem.appendChild(video);
                            carouselInner.appendChild(videoItem);
                        }
                    } else {
                        throw new Error('No video files found');
                    }
                })
                .catch(error => console.error('Error fetching project videos:', error));
        }

        // Function to display attributes and their values inside the "Non Technical Description" category
        function displayNonTechDescriptionAttributes(attributes, excludedAttributes) {
            const nonTechDescInfo = document.querySelector('.portfolio-info ul');
            nonTechDescInfo.innerHTML = ''; // Clear existing content

            // Load the Json_Structure.json file
            fetch('Json_Structure.json')
                .then(response => response.json())
                .then(structure => {
                    // Map AttributeID to label
                    const attributeMap = {};

                    // Recursive function to traverse the attribute structure and build the mapping
                    const buildAttributeMap = (attributes) => {
                        attributes.forEach(attribute => {
                            if (attribute.AttributeID && attribute.label) {
                                attributeMap[attribute.AttributeID] = attribute.label;
                            }
                            if (attribute.children) {
                                attribute.children.forEach(child => buildAttributeMap(child));
                            }
                        });
                    };

                    // Build the attribute map
                    structure.forEach(category => {
                        const categoryAttributes = category["Non Technical Description"];
                        if (categoryAttributes) {
                            buildAttributeMap(categoryAttributes);
                        }
                    });

                    // Iterate through the attributes and display them
                    attributes.forEach(attribute => {
                        // Check if the attribute key should be excluded
                        if (!excludedAttributes.includes(attribute.key)) {
                            const listItem = document.createElement('li');
                            if (Array.isArray(attribute.value)) {
                                // If the value is an array, handle each object
                                const subList = document.createElement('ul');
                                attribute.value.forEach(obj => {
                                    const subListItem = document.createElement('li');
                                    const objValues = Object.values(obj);
                                    objValues.forEach(value => {
                                        const listItem = document.createElement('li');
                                        listItem.textContent = value === null ? '' : value;
                                        subList.appendChild(listItem);
                                    });
                                    subList.appendChild(subListItem);
                                });
                                listItem.innerHTML = `<strong>${attributeMap[attribute.key]}</strong>:`;
                                listItem.appendChild(subList);
                            } else {
                                // If the value is not an array, display it directly
                                const attributeValue = attribute.value === true ? 'Yes' : (attribute.value === false ? 'No' : attribute.value);
                                listItem.innerHTML = `<strong>${attributeMap[attribute.key]}</strong>: ${attributeValue}`;
                            }
                            nonTechDescInfo.appendChild(listItem);
                        }
                    });
                })
                .catch(error => console.error('Error fetching Json_Structure:', error));
        }



        // Function to retrieve and display all categories for a specific project ID
        function displayAllCategories(projectId, excludedAttributes = {}) {
            fetch('projects')
                .then(response => response.json())
                .then(data => {
                    const project = data.find(project => project.id == projectId);
                    if (!project) {
                        throw new Error('Project not found');
                    }

                    // Get all category names
                    const categoryNames = Object.keys(project);

                    // Display attributes for each category
                    categoryNames.forEach(categoryName => {
                        if (excludedAttributes[categoryName]) {
                            if (excludedAttributes[categoryName] === 'all') {
                                // Exclude entire category
                                return;
                            }
                            // Exclude specific attributes
                            const category = project[categoryName];
                            const attributes = Object.entries(category)
                                .filter(([key]) => !excludedAttributes[categoryName].includes(key))
                                .map(([key, value]) => ({ key, value }));
                            displayCategoryAttributes(categoryName, attributes);
                        } else {
                            // Display all attributes by default
                            const category = project[categoryName];
                            const attributes = Object.entries(category)
                                .map(([key, value]) => ({ key, value }));
                            displayCategoryAttributes(categoryName, attributes);
                        }
                    });
                })
                .catch(error => console.error('Error fetching categories:', error));
        }

        // Function to retrieve and display attributes inside a category
        function displayCategoryAttributes(categoryName, attributes) {
            const accordion = document.getElementById('accordionPanelsStayOpenExample');

            // Load the Json_Structure.json file
            fetch('Json_Structure.json')
                .then(response => response.json())
                .then(structure => {
                    // Map AttributeID to label
                    const attributeMap = {};

                    // Recursive function to traverse the attribute structure and build the mapping
                    const buildAttributeMap = (attributes) => {
                        attributes.forEach(attribute => {
                            if (attribute.AttributeID && attribute.label) {
                                attributeMap[attribute.AttributeID] = attribute.label;
                            }
                            if (attribute.children) {
                                attribute.children.forEach(child => buildAttributeMap(child));
                            }
                        });
                    };

                    // Build the attribute map
                    structure.forEach(category => {
                        const categoryAttributes = category[categoryName];
                        if (categoryAttributes) {
                            buildAttributeMap(categoryAttributes);
                        }
                    });

                    // Create accordion item for the category
                    const accordionItem = document.createElement('div');
                    accordionItem.classList.add('accordion-item');

                    // Create accordion header
                    const accordionHeader = document.createElement('h2');
                    accordionHeader.classList.add('accordion-header');
                    accordionHeader.innerHTML = `
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#panelsStayOpen-${categoryName.replace(/ /g, '')}" aria-expanded="false"
                    aria-controls="panelsStayOpen-${categoryName.replace(/ /g, '')}"
                    style="background-color: #eeeeee; font-size: 20px; font-weight: bold;">
                    ${categoryName}
                    </button>
                `;
                    accordionItem.appendChild(accordionHeader);

                    // Create accordion body
                    const accordionBody = document.createElement('div');
                    accordionBody.id = `panelsStayOpen-${categoryName.replace(/ /g, '')}`;
                    accordionBody.classList.add('accordion-collapse', 'collapse');
                    const accordionBodyContent = document.createElement('div');
                    accordionBodyContent.classList.add('accordion-body');

                    // Create list of attributes
                    const attributeList = document.createElement('ul');
                    attributes.forEach(attribute => {
                        const attributeListItem = document.createElement('li');
                        if (Array.isArray(attribute.value)) {
                            // If the value is an array, handle each object
                            const subList = document.createElement('ul');
                            attribute.value.forEach(obj => {
                                const subListItem = document.createElement('li');
                                const pairValues = Object.entries(obj).map(([key, value]) => {
                                    if (attributeMap[key]) {
                                        return `<strong>${attributeMap[key]}</strong>: ${value !== null ? value : ''}`;
                                    } else {
                                        return `<strong>${key}</strong>: ${value !== null ? value : ''}`;
                                    }
                                }).join('<br>');
                                subListItem.innerHTML = `${pairValues}`;
                                subList.appendChild(subListItem);
                            });
                            attributeListItem.innerHTML = `<strong>${attributeMap[attribute.key]}</strong>:<br>`;
                            attributeListItem.appendChild(subList);
                        } else {
                            // Check if the value is boolean and display Yes/No instead of true/false
                            const attributeValue = attribute.value === true ? 'Yes' : (attribute.value === false ? 'No' : (attribute.value !== null ? attribute.value : ''));
                            attributeListItem.innerHTML = `<strong>${attributeMap[attribute.key]}</strong>: ${attributeValue}`;
                        }
                        attributeList.appendChild(attributeListItem);
                    });

                    // Append attribute list to accordion body content
                    accordionBodyContent.appendChild(attributeList);
                    accordionBody.appendChild(accordionBodyContent);

                    // Append accordion body to accordion item
                    accordionItem.appendChild(accordionBody);

                    // Append accordion item to accordion
                    accordion.appendChild(accordionItem);
                })
                .catch(error => console.error('Error fetching Json_Structure:', error));
        }




        // Get the project ID from the URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('id');

        // Fetch the project data
        fetchProjectData(projectId);
    </script>

</body>

</html>